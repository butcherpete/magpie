<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Creating reStructuredText Interpreted Text Roles &#8212; Magpie 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/my-styles.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Extensions" href="extensions.html" />
    <link rel="prev" title="Custom Roles" href="custom-role.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          Magpie</a>
        <span class="navbar-text navbar-version pull-left"><b>0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../vim/index.html">Vim</a></li>
                <li><a href="../sphinx">Sphinx</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../git/git.html">Git Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../film/film.html">Film</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vim/index.html">Vim Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../sphinx.html">Sphinx Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/javascript.html">JavaScript</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="creating-restructuredtext-interpreted-text-roles">
<h1>Creating reStructuredText Interpreted Text Roles<a class="headerlink" href="#creating-restructuredtext-interpreted-text-roles" title="Permalink to this headline">¶</a></h1>
<p>From <a class="reference external" href="http://docutils.sourceforge.net/docs/howto/rst-roles.html">http://docutils.sourceforge.net/docs/howto/rst-roles.html</a></p>
<p>Interpreted text roles are an extension mechanism for inline markup in reStructuredText.  This document aims to make the creation of new roles as easy and understandable as possible.</p>
<div class="section" id="define-the-role-function">
<h2>Define the Role Function<a class="headerlink" href="#define-the-role-function" title="Permalink to this headline">¶</a></h2>
<p>The <code class="code docutils literal notranslate"><span class="pre">role</span></code> function creates and returns inline elements (nodes) and does any additional processing required.  Its signature is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">role_fn</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">rawtext</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">inliner</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">{},</span> <span class="n">content</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">code</span><span class="o">...</span>

<span class="c1"># Set function attributes for customization:</span>
<span class="n">role_fn</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">role_fn</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="o">...</span>
</pre></div>
</div>
<p>The role function parameters are as follows:</p>
<dl class="docutils">
<dt><code class="code docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>The local name of the interpreted role, the role name actually used in the document.</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">rawtext</span></code></dt>
<dd>A string containing the enitre interpreted text input, including the role and markup.  Return it as a <code class="code docutils literal notranslate"><span class="pre">problematic</span></code> node linked to a system message if a problem is encountered.</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">text</span></code></dt>
<dd>The interpreted text content.</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">lineno</span></code></dt>
<dd>The line number where the interpreted text begins.</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">inliner</span></code></dt>
<dd>The <code class="code docutils literal notranslate"><span class="pre">docutils.parsers.rst.states.Inliner</span></code> object that called <code class="code docutils literal notranslate"><span class="pre">role_fn</span></code>.  It contains the several attributes useful for error reporting and document tree access.</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">options</span></code></dt>
<dd>A dictionary of directive options for customization (from the <a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/directives.html#role">role directive</a>), to be interpreted by the role function.  Used for additional attributes for the generated elements and other functionality.</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">content</span></code></dt>
<dd>A list of strings, the directive content for customization (from the <a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/directives.html#role">role directive</a>).  To be interpreted by the role function.</dd>
</dl>
<p>Role functions return a tuple of two values:</p>
<ul class="simple">
<li>A list of nodes which will be inserted into the document tree at the point where the interpreted role was encountered (can be an empty list).</li>
<li>A list of system messages, which will be inserted into the document tree immediately after the end of the current block (can also be empty).</li>
</ul>
</div>
<div class="section" id="specify-role-function-options-and-content">
<h2>Specify Role Function Options and Content<a class="headerlink" href="#specify-role-function-options-and-content" title="Permalink to this headline">¶</a></h2>
<p>Function attributes are for customization, and are interpreted by the
<a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/directives.html#role">role directive</a>.</p>
<p>If unspecified, <code class="code docutils literal notranslate"><span class="pre">role</span></code> function attributes are assumed to have the value <code class="code docutils literal notranslate"><span class="pre">None</span></code>.  Two function attributes are recognized:</p>
<dl class="docutils">
<dt><code class="code docutils literal notranslate"><span class="pre">options</span></code></dt>
<dd><p class="first">The option specification.  All role functions implicitly support the “class” option, unless disabled with an explicit <code class="code docutils literal notranslate"><span class="pre">{'class':</span> <span class="pre">None}</span></code>.</p>
<p>An option specification must be defined detailing the options available to the <code class="code docutils literal notranslate"><span class="pre">role</span></code> directive.  An option spec is a mapping of option name to conversion function; conversion functions are applied to each option value to check validity and convert them to the expected type.</p>
<p class="last">Python’s built-in conversion functions are often usable for this, such as <code class="code docutils literal notranslate"><span class="pre">int</span></code>, <code class="code docutils literal notranslate"><span class="pre">float</span></code>, and <code class="code docutils literal notranslate"><span class="pre">bool</span></code> (included in Python from version 2.2.1).  Other useful conversion functions are included in the <code class="code docutils literal notranslate"><span class="pre">docutils.parsers.rst.directives</span></code> package. For further details, see <a class="reference external" href="http://docutils.sourceforge.net/docs/howto/rst-directives.html#specify-directive-arguments-options-and-content">Creating reStructuredText Directives</a>.</p>
</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">content</span></code></dt>
<dd>A boolean; true if <code class="code docutils literal notranslate"><span class="pre">role</span></code> directive content is allowed. Role functions must handle the case where content is required but not supplied (an empty content list will be supplied).</dd>
</dl>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">As of this writing, no roles accept directive content.</p>
</div>
<p>Note that unlike directives, the <code class="code docutils literal notranslate"><span class="pre">arguments</span></code> function attribute is not supported for role customization.  Directive arguments are handled by the <code class="code docutils literal notranslate"><span class="pre">role</span></code> directive itself.</p>
</div>
<div class="section" id="register-the-role">
<h2>Register the Role<a class="headerlink" href="#register-the-role" title="Permalink to this headline">¶</a></h2>
<p>If the role is a general-use addition to the Docutils core, it must be registered with the parser and language mappings added:</p>
<ol class="arabic">
<li><p class="first">Register the new role using the canonical name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="k">import</span> <span class="n">roles</span>
<span class="n">roles</span><span class="o">.</span><span class="n">register_canonical_role</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">role_function</span><span class="p">)</span>
</pre></div>
</div>
<p>This code is normally placed immediately after the definition of the role funtion.</p>
</li>
<li><p class="first">Add an entry to the <code class="code docutils literal notranslate"><span class="pre">roles</span></code> dictionary in <code class="code docutils literal notranslate"><span class="pre">docutils/parsers/rst/languages/en.py</span></code> for the role, mapping the English name to the canonical name (both lowercase).  Usually the English name and the canonical name are the same.  Abbreviations and other aliases may also be added here.</p>
</li>
<li><p class="first">Update all the other language modules as well.  For languages in which you are proficient, please add translations.  For other languages, add the English role name plus “(translation required)”.</p>
</li>
</ol>
<p>If the role is application-specific, use the <code class="code docutils literal notranslate"><span class="pre">register_local_role</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="k">import</span> <span class="n">roles</span>
<span class="n">roles</span><span class="o">.</span><span class="n">register_local_role</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">role_function</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>For the most direct and accurate information, “Use the Source, Luke!”.</p>
<p>All standard roles are documented in <a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/roles.html">reStructuredText Interpreted Text Roles</a>, and the source code implementing them is located in the <code class="code docutils literal notranslate"><span class="pre">docutils/parsers/rst/roles.py</span></code> module.  Several representative roles are described below.</p>
<div class="section" id="generic-roles">
<h3>Generic Roles<a class="headerlink" href="#generic-roles" title="Permalink to this headline">¶</a></h3>
<p>Many roles simply wrap a given element around the text.  There’s a special helper function, <code class="code docutils literal notranslate"><span class="pre">register_generic_role</span></code>, which generates a role function from the canonical role name and node class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">register_generic_role</span><span class="p">(</span><span class="s1">&#39;emphasis&#39;</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">emphasis</span><span class="p">)</span>
</pre></div>
</div>
<p>For the implementation of <code class="code docutils literal notranslate"><span class="pre">register_generic_role</span></code>, see the <code class="code docutils literal notranslate"><span class="pre">docutils.parsers.rst.roles</span></code> module.</p>
</div>
<div class="section" id="rfc-reference-role">
<h3>RFC Reference Role<a class="headerlink" href="#rfc-reference-role" title="Permalink to this headline">¶</a></h3>
<p>This role allows easy references to <a class="reference external" href="http://foldoc.doc.ic.ac.uk/foldoc/foldoc.cgi?query=rfc&amp;action=Search&amp;sourceid=Mozilla-search">RFCs</a> (Request For Comments documents) by automatically providing the base URL, <code class="code docutils literal notranslate"><span class="pre">http://www.faqs.org/rfcs/</span></code>, and appending the RFC document itself (rfcXXXX.html, where XXXX is the RFC number).  For example:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span>See <span class="na">:RFC:</span><span class="nv">`2822`</span> for information about email headers.
</pre></div>
</div>
<p>Here is the implementation of the role:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="k">def</span> <span class="nf">rfc_reference_role</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="n">rawtext</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">inliner</span><span class="p">,</span>
                         <span class="n">options</span><span class="o">=</span><span class="p">{},</span> <span class="n">content</span><span class="o">=</span><span class="p">[]):</span>

      <span class="c1"># The interpreted text itself should contain the RFC number.</span>
      <span class="c1"># The try clause verifies by converting it to an integer.</span>
      <span class="k">try</span><span class="p">:</span>
          <span class="n">rfcnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">rfcnum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
              <span class="k">raise</span> <span class="ne">ValueError</span>

      <span class="c1"># If the conversion fails, the except clause is executed: a system</span>
      <span class="c1"># message is generated, the entire interpreted text construct (in</span>
      <span class="c1"># rawtext) is wrapped in a problematic node (linked to the</span>
      <span class="c1"># system message), and the two are returned.</span>
      <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
          <span class="n">msg</span> <span class="o">=</span> <span class="n">inliner</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
              <span class="s1">&#39;RFC number must be a number greater than or equal to 1; &#39;</span>
              <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot; is invalid.&#39;</span> <span class="o">%</span> <span class="n">text</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
          <span class="n">prb</span> <span class="o">=</span> <span class="n">inliner</span><span class="o">.</span><span class="n">problematic</span><span class="p">(</span><span class="n">rawtext</span><span class="p">,</span> <span class="n">rawtext</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
          <span class="k">return</span> <span class="p">[</span><span class="n">prb</span><span class="p">],</span> <span class="p">[</span><span class="n">msg</span><span class="p">]</span>
      <span class="c1"># Base URL mainly used by inliner.rfc_reference, so this is correct:</span>
      <span class="n">ref</span> <span class="o">=</span> <span class="n">inliner</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">rfc_base_url</span> <span class="o">+</span> <span class="n">inliner</span><span class="o">.</span><span class="n">rfc_url</span> <span class="o">%</span> <span class="n">rfcnum</span>

      <span class="c1"># The ``options`` function parameter, a dictionary, may contain a</span>
      <span class="c1"># &quot;class&quot; customization attribute; it is interpreted and replaced</span>
      <span class="c1"># with a &quot;classes&quot; attribute by the ``set_classes()`` function.  The</span>
      <span class="c1"># resulting &quot;classes&quot; attribute is passed through to the &quot;reference&quot;</span>
      <span class="c1"># element node constructor.</span>
      <span class="n">set_classes</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

      <span class="c1"># RFC reference is constructed from a stock URI, set as refuri attribute</span>
      <span class="c1"># of a reference element</span>
      <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">reference</span><span class="p">(</span><span class="n">rawtext</span><span class="p">,</span> <span class="s1">&#39;RFC &#39;</span> <span class="o">+</span> <span class="n">utils</span><span class="o">.</span><span class="n">unescape</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">refuri</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="p">[]</span>

  <span class="n">register_canonical_role</span><span class="p">(</span><span class="s1">&#39;rfc-reference&#39;</span><span class="p">,</span> <span class="n">rfc_reference_role</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>See <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2822.html"><strong>RFC 2822</strong></a> for information about email headers.</p>
</div>
</div>
<div class="section" id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="http://docutils.sourceforge.net/docs/howto/rst-roles.html">Creating reStructuredText Interpreted Text Roles</a></li>
<li><a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/roles.html">reStructuredText Interpreted Text Roles</a></li>
<li><a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/restructuredtext.html#interpreted-text">Interpreted Text</a></li>
</ul>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../_sources/sphinx/grp-2/text-roles.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2018, Todd Smith.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>